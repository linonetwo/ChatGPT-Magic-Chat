{"tiddlers":{"$:/plugins/linonetwo/zx-script/OutputBar":{"title":"$:/plugins/linonetwo/zx-script/OutputBar","creator":"LinOnetwo","tags":"$:/tags/ViewTemplate","type":"text/vnd.tiddlywiki","list-before":"$:/plugins/linonetwo/inverse-link-and-folder/infobar","text":"<$list filter=\"[{!!title}addprefix[$:/state/linonetwo/zx-script/output/]is[tiddler]then{!!title}]\">\n  <$list filter=\"[{!!title}addprefix[$:/state/linonetwo/zx-script/output/]]\">\n    <!-- Space between top level and inner level transclude can't be omit, otherwise generated line will stick together, and destroy the tw render -->\n    <$transclude>\n\n      <$transclude tiddler=\"$:/language/MissingTiddler/Hint\"/>\n\n    </$transclude>\n\n    <small><$link to=<<currentTiddler>> /></small>\n  </$list>\n</$list>\n"},"$:/plugins/linonetwo/zx-script/ViewToolbarButton":{"title":"$:/plugins/linonetwo/zx-script/ViewToolbarButton","tags":"$:/tags/ViewToolbar","type":"text/vnd.tiddlywiki","list-before":"$:/core/ui/Buttons/close","caption":"{{$:/plugins/linonetwo/zx-script/zx-icon}} {{$:/plugins/linonetwo/zx-script/zx-button-caption}}","short-caption":"zx script executor","description":"Run tiddler as ZX Script","text":"\\whitespace trim\n<$execute-zx-script content={{!!text}} title={{!!title}} type={{!!type}} />\n"},"$:/plugins/linonetwo/zx-script/button.js":{"title":"$:/plugins/linonetwo/zx-script/button.js","text":"(function () {\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\n\n  class ZXExecuteButtonWidget extends Widget {\n    /**\n     * Lifecycle method: call this.initialise and super\n     */\n    constructor(parseTreeNode, options) {\n      super(parseTreeNode, options);\n      this.initialise(parseTreeNode, options);\n    }\n\n    /**\n     * Lifecycle method: Render this widget into the DOM\n     */\n    render(parent, nextSibling) {\n      this.parentDomNode = parent;\n      this.computeAttributes();\n      const importButton = this.document.createElement('button');\n      $tw.utils.addClass(importButton, 'tc-btn-invisible');\n      importButton.innerHTML = `${$tw.wiki.getTiddlerText(\n        '$:/plugins/linonetwo/zx-script/zx-icon',\n      )}<span class=\"tc-btn-text tc-button-zx-script-caption\">${$tw.wiki.getTiddlerText('$:/plugins/linonetwo/zx-script/zx-button-caption')}</span>`;\n      importButton.onclick = this.onExecuteButtonClick.bind(this);\n      importButton.title = importButton.ariaLabel = 'ZX';\n      parent.insertBefore(importButton, nextSibling);\n      this.domNodes.push(importButton);\n    }\n\n    /**\n     * Event listener of button\n     */\n    async onExecuteButtonClick() {\n      const title = this.getAttribute('title');\n      if (!title) return;\n      const type = this.getAttribute('type') || 'text/vnd.tiddlywiki';\n      const stateTiddlerTitle = `$:/state/linonetwo/zx-script/output/${title}`;\n      let fileName = title.replace(/[/$:]/g, '-');\n      let fileContent = this.getAttribute('content', '');\n      // add mjs or md to the end\n      if (!fileName.endsWith('.mjs') && !fileName.endsWith('.js') && !fileName.endsWith('.md')) {\n        switch (type) {\n          // try fit everything that may have ```js block into md\n          case 'text/vnd.tiddlywiki':\n          case 'text/plain':\n          case 'text/markdown':\n          case 'text/x-markdown':\n          case 'text/html': {\n            fileName += '.md';\n            break;\n          }\n          case 'application/javascript':\n          default: {\n            fileName += '.mjs';\n            break;\n          }\n        }\n      }\n\n      $tw.wiki.setText(stateTiddlerTitle, 'text', undefined, '');\n      window.observables.native\n        .executeZxScript$({\n          fileContent,\n          fileName,\n        })\n        .subscribe((output) => {\n          const prevText = $tw.wiki.getTiddlerText(stateTiddlerTitle);\n          $tw.wiki.setText(stateTiddlerTitle, 'text', undefined, `${prevText ?? ''}\\n${output ?? ''}`);\n          $tw.wiki.setText(stateTiddlerTitle, 'type', undefined, 'text/vnd.tiddlywiki');\n        });\n    }\n  }\n\n  exports['execute-zx-script'] = ZXExecuteButtonWidget;\n})();\n","type":"application/javascript","module-type":"widget"},"$:/plugins/linonetwo/zx-script/codeblock.js":{"title":"$:/plugins/linonetwo/zx-script/codeblock.js","text":"const BaseCodeBlockWidget = require('$:/core/modules/widgets/codeblock.js').codeblock;\n\n// Hijack core codeblock widget render()\nBaseCodeBlockWidget.prototype.render = function (parent, nextSibling) {\n  this.parentDomNode = parent;\n  this.computeAttributes();\n  this.execute();\n  const codeElement = this.document.createElement('code');\n  const preElement = this.document.createElement('pre');\n  codeElement.appendChild(this.document.createTextNode(this.getAttribute('code')));\n  preElement.appendChild(codeElement);\n\n  const language = this.getAttribute('language');\n  const outputElement = this.document.createElement('pre');\n  outputElement.style.display = 'none';\n  if (['md', 'js', 'javascript', 'ts', 'typescript', 'bash', 'shell', 'sh', 'zsh'].includes(language)) {\n    const executeButtonElement = this.document.createElement('button');\n    executeButtonElement.innerText = 'ZX';\n    executeButtonElement.className = 'code-block-zx-script-execution-button';\n    executeButtonElement.addEventListener('click', () => {\n      let fileName = 'tmp';\n      let fileContent = this.getAttribute('code');\n      switch (language) {\n        case 'md': {\n          fileName += '.md';\n          break;\n        }\n        case 'js':\n        case 'javascript': {\n          fileName += '.mjs';\n          break;\n        }\n        case 'ts':\n        case 'typescript': {\n          fileName += '.ts';\n          break;\n        }\n        case 'bash':\n        case 'zsh':\n        case 'shell':\n        case 'sh': {\n          fileName += '.mjs';\n          fileContent = fileContent\n            .split('\\n')\n            .map((line) => `await \\$\\`${line.trim()}\\`;`)\n            .join('\\n');\n          break;\n        }\n        default: {\n          outputElement.innerText = `ZX don't execute ${language}`;\n          return;\n        }\n      }\n\n      outputElement.innerText = '';\n      outputElement.style.display = 'flex';\n      $tw.utils.addClass(outputElement, 'hljs');\n      $tw.utils.addClass(outputElement, 'js');\n      $tw.utils.addClass(outputElement, 'javascript');\n      window.observables.native\n        .executeZxScript$({\n          fileContent,\n          fileName,\n        })\n        .subscribe((output) => {\n          const prevText = outputElement.innerText;\n          outputElement.innerText = `${prevText}${prevText ? '\\n' : ''}${output ?? ''}`;\n        });\n    });\n\n    parent.insertBefore(executeButtonElement, nextSibling);\n  }\n\n  parent.insertBefore(preElement, nextSibling);\n  parent.insertBefore(outputElement, nextSibling);\n  this.domNodes.push(preElement);\n  if (this.postRender) {\n    this.postRender();\n  }\n};\n","type":"application/javascript","module-type":"widget"},"$:/plugins/linonetwo/zx-script/demo":{"title":"$:/plugins/linonetwo/zx-script/demo","type":"text/vnd.tiddlywiki","text":"!! ZX JS script Demo\n\n```js\nconsole.log(`!! Hi!`);\n```\n\nResult will form a tiddler.\n\n```js\nconsole.log(`\nCode block:\n\n\\`\\`\\`js\nconsole.log(\\`!! Hi!\\`);\n\\`\\`\\`\n`);\n```\n\n!! Wiki Scripting Demo\n\n```js\nconst exampleTitle = '$:/plugins/linonetwo/zx-script/style.css';\n\n// write a console.log that is start with this separator ↓\nconsole.log(`/** tw */\n// You can use $tw.wiki.getTiddler to get tiddler data, don't forget to wrap variable with ' '\nconst tiddlerData = $tw.wiki.getTiddler('${exampleTitle}');\n// This script runs in the nodejs side, and you can't access some API from nodejs ↓ it will cause error\n// $tw.notifier.display('$:/state/notification/asdf');\n\n// You can even add tiddler using the API! But this will be add to the nodejs side, it will take a while to wait it sync to the browser side.\n// $tw.syncadaptor.wiki.addTiddler({ title: 'asdf', text: 'aaa bbb' });\n// You can't add state tiddler this way, they won't get sync to the browser.\n// $tw.syncadaptor.wiki.addTiddler({ title: '$:/state/notification/asdf', text: 'aaa bbb' });\n\n// You can use console to print some data\nconsole.log(tiddlerData.fields.type);\n// You can return some data in the last line, it will be logged out to you.\nJSON.stringify(tiddlerData);\n\n// ↓ Don't forget to end the block with separator!\n/** tw */\n`);\n```\n"},"$:/plugins/linonetwo/zx-script/developer":{"title":"$:/plugins/linonetwo/zx-script/developer","type":"text/vnd.tiddlywiki","text":"!! Developer guide\n\n!!! Icon\n\nIf you want to change the icon/text of the button, you need to change both [[ViewToolbarButton.tid|$:/plugins/linonetwo/zx-script/ViewToolbarButton]]'s caption field, and [[button.js|$:/plugins/linonetwo/zx-script/button.js]]'s `importButton.innerHTML = xxxx`.\n\nBecause we are using javascript to write the widget, it can't benefit from the caption field of tiddler that add tag [[$:/tags/ViewToolbar]].\n\nAnd so the caption add by javascript is shown not properly in view-toolbar, it will display both the icon and the text. So we need to use `.tc-tiddler-controls > button > .tc-button-zx-script-caption` to hide the text when it is in the view-toolbar.\n\n!!! List before\n\nWe use\n\n```tid\nlist-before: $:/plugins/linonetwo/inverse-link-and-folder/infobar\n```\n\nto make sure zx output is placed above the backlinks plugin.\n\n!!! Output\n\nWe place output of zx to a temporary tiddler, whose name start with \"$:/state/linonetwo/zx-script/output/\"\n\nAnd we get the name of this tiddler in wikitext using `[{!!title}addprefix[$:/state/linonetwo/zx-script/output/]`, so it can be transcluded with `{{{ }}}`\n"},"$:/plugins/linonetwo/zx-script/readme":{"title":"$:/plugins/linonetwo/zx-script/readme","created":"20210915220048497","type":"text/vnd.tiddlywiki","text":"!! Background\n\n[[google/zx|https://github.com/google/zx]] is a tool for writing better scripts, with Javascript.\n\nThis tiddlywiki plugin enables you to run any tiddler with zx.\n\n!! Basic Usage\n\n!!! Tiddler Type\n\nTiddler with title extension `*.js *.md *.mjs` can be execute without problem. Other tiddler witout extension (no `.xxx`) will be executed as `*.md` file, for example, tid file without extions will be executed as `*.md`, but it works without problem too, even you are writing wiki text instead of markdown.\n\nIf you add filetype `application/javascript` to your tiddler, it will be recognized as `*.mjs`.\n\n!!! Prerequisit\n\nThis plugin requires [TiddlyGit](https://github.com/tiddly-gittly/TiddlyGit-Desktop) environment to function properly. It will send tiddler content to the `zx` inside TiddlyGit, and prints the output.\n\n!!! Button\n\nA ViewToolbar button is added. You can click on it to execute the script inside your tiddler.\n\nAnd the zx output will be printed below your tiddler content.\n\n!!! Demo\n\n```js\nconsole.log(`## Hi!`);\n```\n\nSee [[$:/plugins/linonetwo/zx-script/demo]] for demo of full tiddler execution.\n\n!! Wiki Scripting\n\n!!! Execute the code block on the $tw context\n\nYou can write some code that is surrounded with `/** tw */` separator. They will be recognized as js code and executed on the context that have access to the $tw api.\n\nGlobal variables you can use:\n\n* `$tw` try it in your [[developer tool|https://developer.mozilla.org/en-US/docs/Tools]] to play around!\n* `_` [[lodash|https://lodash.com/docs/]]\n\nThis means you can fetch some data on the zx script, and write the results to the wiki, creating new tiddlers.\n\n!!! Access filter and macros\n\nFilter function's call example is\n\n```js\n$tw.wiki.filterOperators.sum((callback) => {callback({}, '2');callback({}, '2')})\n```\n\n!! Developer Documentation\n\nSee [[$:/plugins/linonetwo/zx-script/developer]]\n"},"$:/plugins/linonetwo/zx-script/style.css":{"title":"$:/plugins/linonetwo/zx-script/style.css","text":".tc-tiddler-controls button .tc-button-zx-script-caption {\n  display: none;\n}\n\n.code-block-zx-script-execution-button {\n  position: absolute;\n  right: 0;\n  /* default not hovered state */\n  opacity: 0.3;\n}\n.code-block-zx-script-execution-button:hover {\n  opacity: 0.8;\n}\n.code-block-zx-script-execution-button:active {\n  opacity: 1;\n}\n","creator":"LinOnetwo","tags":"$:/tags/Stylesheet","type":"text/css"},"$:/plugins/linonetwo/zx-script/zx-button-caption":{"title":"$:/plugins/linonetwo/zx-script/zx-button-caption","type":"text/vnd.tiddlywiki","text":"ZX Script"},"$:/plugins/linonetwo/zx-script/zx-icon":{"title":"$:/plugins/linonetwo/zx-script/zx-icon","tags":"$:/tags/Image","text":"<svg width=\"22pt\" height=\"22pt\" class=\"tc-image-zx-script tc-image-button\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 100 90.25\"><path d=\"M93.103,83.904c0,0,1.708-1.634,3.242,0c1.535,1.634,0.322,2.203-0.223,2.426c-0.544,0.223-2.623,0.446-3.341-0.197 S92.635,84.248,93.103,83.904z\"></path><path d=\"M89.241,79.622c0,0,3.144-3.021,4.827-0.842c1.683,2.178,1.312,3.021-1.486,3.614c-2.796,0.595-3.861,1.263-5.37,0.595 c-1.511-0.669-2.005-2.13,0.495-2.724C89.241,79.622,89.241,79.622,89.241,79.622z\"></path><path d=\"M83.598,73.087c0.074-0.123,2.772-2.054,4.802-1.782c2.03,0.272,3.045,1.46,3.688,2.476s0.247,2.476-1.708,3.095 c-1.955,0.618-4.184,1.633-5.272,2.376c-1.089,0.742-2.302,0.989-3.317,0.42c-1.014-0.569-3.144-0.668-3.837-2.426 c-0.692-1.757,1.238-1.731,1.882-2.128S83.598,73.087,83.598,73.087z\"></path><path d=\"M74.191,66.429c0,0,4.554-3.218,7.476-3.664c2.921-0.445,4.652,0.99,5.891,2.625c1.237,1.633,2.438,4.059-1.603,5 c-4.041,0.94-5.328,2.029-6.17,2.524c-0.841,0.494-3.861,2.178-5.841,2.079c-1.98-0.099-4.803-1.089-5.842-1.881 c-1.04-0.792-2.872-1.733,0-3.268c2.871-1.535,4.059-2.277,4.059-2.277L74.191,66.429z\"></path><path d=\"M68.828,53.541c0,0,5.742-3.497,8.978-3.564c3.234-0.066,3.894,0.396,4.884,2.508c0.99,2.114,2.399,4.555,2.399,4.555 s0.636,2.708-2.796,3.631c-3.431,0.925-8.05,3.563-10.164,4.488c-2.113,0.925-6.206,4.818-11.024,4.753 c-4.817-0.065-8.978-1.518-10.297-3.894c-1.32-2.377,0.726-3.895,2.574-3.961c1.849-0.067,7.591-3.696,8.977-4.29 C63.746,57.173,68.828,53.541,68.828,53.541z\"></path><path d=\"M51.203,40.271l8.581-3.563c0,0,6.206-1.979,8.714-1.451c2.508,0.527,5.741,2.376,6.864,3.96s2.398,6.006,2.288,7.063 s-5.918,3.17-8.162,4.226c-2.245,1.056-13.004,6.007-14.588,7.128c-1.584,1.122-10.033,3.299-12.739,3.036 c-2.707-0.263-9.308-2.772-10.628-4.555s-3.367-3.763-0.99-4.95c2.376-1.188,6.138-2.573,8.118-3.828 C40.643,46.082,51.203,40.271,51.203,40.271z\"></path><path d=\"M28.894,11.229c0,0,14.158-0.198,16.535,0c2.376,0.198,13.367,0.495,16.139,2.277s5.941,5.644,7.128,8.614 c1.188,2.97,2.675,7.525,0,8.713c-2.673,1.188-14.06,5.743-17.425,7.624c-3.367,1.881-16.734,6.832-18.714,7.822 c-1.98,0.99-10.396,5.897-14.654,3.691c-4.258-2.205-7.525-11.91-7.921-14.384c0,0-2.475-5.743-2.673-15.644 c0,0-0.297-2.674-1.881-6.832c-1.584-4.159-3.07-6.436-3.07-6.436S0.675,0.833,4.041,2.516c3.366,1.683,2.818,2.161,6.237,3.564 c3.862,1.584,10,3.367,10.595,3.564C21.467,9.843,28.894,11.229,28.894,11.229z\"></path></svg>"},"$:/plugins/linonetwo/zx-script/zx-script-output.js":{"title":"$:/plugins/linonetwo/zx-script/zx-script-output.js","text":"(function () {\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\n\n  class ZXOutputWidget extends Widget {\n    /**\n     * Lifecycle method: call this.initialise and super\n     */\n    constructor(parseTreeNode, options) {\n      super(parseTreeNode, options);\n      this.initialise(parseTreeNode, options);\n    }\n\n    get stateTiddlerTitle() {\n      const title = this.getAttribute('title', 'aaa.mjs');\n      const stateTiddlerTitle = `$:/state/linonetwo/zx-script/output/${title}`;\n      return stateTiddlerTitle;\n    }\n\n    /**\n     * Lifecycle method: Render this widget into the DOM\n     */\n    render(parent, nextSibling) {\n      this.parentDomNode = parent;\n      this.computeAttributes();\n\n      const outputElement = this.document.createElement('article');\n      outputElement.innerHTML = ($tw.wiki.getTiddlerText(this.stateTiddlerTitle) ?? '')\n        .split('\\n')\n        .map((line) => `<div>${line}</div>`)\n        .join('');\n      parent.insertBefore(outputElement, nextSibling);\n      this.domNodes.push(outputElement);\n    }\n\n    refresh(changedTiddlers) {\n      if (this.stateTiddlerTitle in changedTiddlers && changedTiddlers[this.stateTiddlerTitle]?.modified) {\n        this.refreshSelf();\n        return true;\n      }\n      return false;\n    }\n  }\n\n  exports['zx-script-output'] = ZXOutputWidget;\n})();\n","type":"application/javascript","module-type":"widget"}}}